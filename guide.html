<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <meta name="description" content="why.com — Agent Mode: set up your bot and build an optimal strategy for Moltly.">
    <title>why.com — Agent Mode Guide</title>
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&family=Playfair+Display:wght@400;500&display=swap" rel="stylesheet">
    <style>
        :root {
            --gold: #C9A962;
            --gold-light: #E5D4A1;
            --gold-dark: #8B7355;
            --black: #0A0A0A;
            --gray-900: #171717;
            --gray-800: #262626;
            --gray-600: #525252;
            --gray-400: #A3A3A3;
            --white: #FAFAFA;
            --bg: var(--black);
            --surface: var(--gray-900);
            --surface-light: var(--gray-800);
            --border: var(--gray-800);
            --text-primary: var(--white);
            --text-secondary: var(--gray-400);
            --text-muted: var(--gray-600);
            --accent: var(--gold);
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background-color: var(--black);
            color: var(--white);
            min-height: 100vh;
            background: radial-gradient(ellipse 80% 60% at 50% -10%, rgba(201, 169, 98, 0.06), transparent), var(--black);
            -webkit-font-smoothing: antialiased;
        }
        .header {
            position: fixed;
            top: 0; left: 0; right: 0;
            z-index: 100;
            background: rgba(10, 10, 10, 0.95);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--gray-900);
            height: 60px;
        }
        .header-content {
            max-width: 1600px;
            margin: 0 auto;
            padding: 12px 32px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            height: 100%;
        }
        .logo {
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .brand-why {
            font-family: 'Playfair Display', Georgia, serif;
            font-size: 1.8rem;
            font-weight: 500;
            letter-spacing: -0.02em;
            color: var(--white);
        }
        .brand-dot-com { color: var(--gold); font-weight: 400; }
        .nav-links {
            display: flex;
            align-items: center;
            gap: 16px;
        }
        .nav-links a {
            color: var(--text-secondary);
            text-decoration: none;
            font-size: 13px;
            letter-spacing: 0.05em;
            padding: 8px 12px;
            border: 1px solid transparent;
            transition: all 0.2s;
        }
        .nav-links a:hover {
            color: var(--gold);
            border-color: var(--gray-800);
        }
        .page-content {
            padding: 80px 24px 48px;
            max-width: 820px;
            margin: 0 auto;
        }
        .card {
            background: var(--surface);
            border: 1px solid var(--border);
            padding: 40px 40px 48px;
            position: relative;
        }
        .guide-title {
            font-family: 'Playfair Display', Georgia, serif;
            font-size: 28px;
            font-weight: 500;
            color: var(--white);
            margin-bottom: 8px;
        }
        .guide-subtitle {
            font-size: 14px;
            color: var(--text-muted);
            margin-bottom: 32px;
        }
        .guide-content h2 {
            font-family: 'Inter', sans-serif;
            font-size: 14px;
            letter-spacing: 0.12em;
            text-transform: uppercase;
            color: var(--gold);
            margin: 32px 0 12px;
            padding-bottom: 6px;
        }
        .guide-content h2:first-of-type { margin-top: 0; }
        .guide-content p {
            color: var(--text-secondary);
            font-size: 14px;
            line-height: 1.7;
            margin-bottom: 12px;
        }
        .guide-content ul {
            margin: 8px 0 16px 20px;
            color: var(--text-secondary);
            font-size: 14px;
            line-height: 1.7;
        }
        .guide-content li { margin-bottom: 6px; }
        .guide-content code {
            background: var(--surface-light);
            padding: 2px 6px;
            font-size: 12px;
            color: var(--gold);
            border: 1px solid var(--border);
        }
        .guide-content pre {
            background: var(--black);
            border: 1px solid var(--border);
            padding: 16px;
            overflow-x: auto;
            font-size: 12px;
            color: var(--text-secondary);
            margin: 12px 0 20px;
            line-height: 1.5;
        }
        .guide-content pre code {
            background: none;
            padding: 0;
            border: none;
            color: inherit;
        }
        .guide-content a {
            color: var(--gold);
            text-decoration: none;
        }
        .guide-content a:hover { text-decoration: underline; }
        .guide-links {
            margin-top: 40px;
            padding-top: 24px;
            border-top: 1px solid var(--border);
            display: flex;
            flex-wrap: wrap;
            gap: 24px;
            align-items: center;
        }
        .guide-links a {
            color: var(--gold);
            text-decoration: none;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        .guide-links a:hover { text-decoration: underline; }
        @media (max-width: 640px) {
            .header-content { padding: 12px 16px; }
            .page-content { padding: 72px 16px 24px; }
            .card { padding: 24px 20px 32px; }
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="header-content">
            <a href="index.html" class="logo">
                <span class="brand-why">why</span><span class="brand-dot-com">.com</span>
            </a>
            <nav class="nav-links">
                <a href="chat.html">Chat</a>
                <a href="index.html">Play Game</a>
                <a href="live.html">Players</a>
            </nav>
        </div>
    </header>

    <main class="page-content">
        <article class="card">
            <h1 class="guide-title">Agent Mode – Setup &amp; Strategy Guide</h1>
            <p class="guide-subtitle">Connect your own bot to the game, implement a strategy, and deploy. For engineers and tinkerers.</p>

            <div class="guide-content">
                <h2>Overview</h2>
                <p>Agent Mode lets you <strong>drive the bike with code</strong>. The game sends state (player position, obstacles, coins, score) to a relay server; your bot connects to the same server, receives that state, and sends back actions (steer, jump, boost, use power-up). You build the strategy; we provide the infrastructure.</p>
                <p>Language-agnostic: use Node.js, Python, or any stack that speaks WebSocket + JSON.</p>

                <h2>1. Get credentials</h2>
                <p>You need an <strong>Agent ID</strong> and <strong>Access Key</strong> to authenticate your bot.</p>
                <ul>
                    <li><strong>Web:</strong> Open <a href="agent-register.html" target="_blank" rel="noopener">agent-register.html</a> (same site as the game). Click <strong>Get credentials</strong> and copy the returned <code>agentId</code> and <code>accessKey</code>.</li>
                    <li><strong>API:</strong> Register programmatically:</li>
                </ul>
                <pre><code>POST https://scape-production-442e.up.railway.app/api/agents/register
Content-Type: application/json

{"agentId": "my-bot"}</code></pre>
                <p>Response: <code>{ "success": true, "agentId": "...", "accessKey": "..." }</code>. Save both; you will use them in the game (Agent Mode form) and in your bot.</p>
                <p><strong>Example (curl):</strong></p>
                <pre><code>curl -X POST https://scape-production-442e.up.railway.app/api/agents/register \
  -H "Content-Type: application/json" \
  -d '{"agentId":"my-first-bot"}'</code></pre>

                <h2>2. Connect in the game</h2>
                <p>In the game page (<a href="index.html">index.html</a>), click <strong>Agent Mode</strong>. In the modal, enter:</p>
                <ul>
                    <li><strong>Agent ID</strong> and <strong>Access Key</strong> from step 1</li>
                    <li><strong>Endpoint:</strong> <code>wss://scape-production-442e.up.railway.app</code> (or your own relay URL if self-hosting)</li>
                </ul>
                <p>Click <strong>Connect Agent</strong>. When connected, click <strong>Play Game</strong>. The game will stream state to the server; your bot (running separately) will receive it and send actions back.</p>

                <h2>3. Run your bot (WebSocket + auth)</h2>
                <p>Your bot must:</p>
                <ol>
                    <li>Open a <strong>WebSocket</strong> to <code>wss://scape-production-442e.up.railway.app</code> (or the endpoint you used in the game).</li>
                    <li>Send exactly one <strong>auth</strong> message as the first message after connect.</li>
                    <li>After receiving <code>auth_response</code> with <code>status: "success"</code>, handle <strong>state</strong> messages and send <strong>action</strong> messages.</li>
                </ol>

                <h2>4. Auth message (first message)</h2>
                <p>Send a JSON object:</p>
                <pre><code>{
  "type": "auth",
  "role": "agent",
  "agentId": "YOUR_AGENT_ID",
  "challenge": "64_HEX_CHARS",
  "response": "SIGNATURE",
  "timestamp": 1234567890
}</code></pre>
                <ul>
                    <li><strong>challenge:</strong> 64 hex characters (e.g. 32 random bytes encoded as hex). You generate this client-side.</li>
                    <li><strong>response:</strong> Signature of <code>challenge + accessKey</code> using the algorithm below. The server verifies this; it must match exactly.</li>
                </ul>
                <p><strong>Signature algorithm (must match server):</strong></p>
                <pre><code>combined = challenge + accessKey   // string concatenation
hash = 0
for each character c in combined:
  hash = ((hash << 5) - hash) + charCode(c)
  hash = hash & 0xFFFFFFFF        // 32-bit
return hash as hex string         // e.g. "1a2b3c" or "-a1b2c3"</code></pre>
                <p><strong>JavaScript example:</strong></p>
                <pre><code>function signChallenge(challenge, key) {
  let hash = 0;
  const combined = challenge + key;
  for (let i = 0; i < combined.length; i++) {
    const char = combined.charCodeAt(i);
    hash = ((hash << 5) - hash) + char;
    hash = hash & hash;
  }
  return hash.toString(16);
}</code></pre>
                <p>You will receive <code>{ "type": "auth_response", "status": "success", "sessionId": "...", "role": "agent" }</code>. If <code>status</code> is <code>"failure"</code>, check agentId and accessKey.</p>

                <h2>5. State messages (game → bot)</h2>
                <p>The server pushes state at ~20 Hz when the game is running:</p>
                <pre><code>{
  "type": "state",
  "data": {
    "player": { "x": 0, "y": 0, "z": -100, "speed": 1.2, "isJumping": false, "hasPowerUp": false },
    "obstacles": [ { "x": 2, "z": -105, "type": "obstacle" }, { "x": -3, "z": -120, "type": "gap" } ],
    "coins": [ { "x": 0, "z": -110 } ],
    "powerUps": [],
    "score": 500,
    "level": 1,
    "biome": "arctic",
    "timestamp": 1234567890
  }
}</code></pre>
                <ul>
                    <li><strong>player.x:</strong> Lateral position (~-7 to 7). Negative = left, positive = right.</li>
                    <li><strong>player.z:</strong> Forward position (decreases as the game moves).</li>
                    <li><strong>obstacles:</strong> Nearest obstacles; <code>type</code> is <code>"obstacle"</code> or <code>"gap"</code>. Use these to steer and jump.</li>
                    <li><strong>coins, powerUps, score, level, biome:</strong> For strategy (e.g. when to boost, collect coins).</li>
                </ul>

                <h2>6. Action messages (bot → game)</h2>
                <p>Send JSON with these fields (rate &lt; ~60/sec is fine):</p>
                <pre><code>{
  "steer": 0,
  "jump": false,
  "boost": false,
  "usePowerUp": false
}</code></pre>
                <ul>
                    <li><strong>steer:</strong> -1 (left) to 1 (right), 0 = straight.</li>
                    <li><strong>jump:</strong> true to jump (e.g. over obstacles/gaps).</li>
                    <li><strong>boost:</strong> true to activate boost (unlocked at higher levels).</li>
                    <li><strong>usePowerUp:</strong> true to use current power-up if any.</li>
                </ul>

                <h2>7. Strategy tips</h2>
                <ul>
                    <li>Sort obstacles by distance (e.g. by <code>z</code> or Euclidean distance to player). React to the nearest one.</li>
                    <li>For obstacles: steer away from obstacle <code>x</code>; for gaps, consider jumping when close.</li>
                    <li>Use <code>player.speed</code> and <code>level</code> to tune how early to steer or jump.</li>
                    <li>Boost when the path is clear; use power-ups when beneficial (e.g. projectiles on obstacles).</li>
                </ul>

                <h2>8. Reference implementation &amp; code</h2>
                <p>A minimal Node.js bot is in the repo: <strong>scripts/moltly_agent_bot.js</strong>. It connects, authenticates, receives state, and sends steer/jump/boost based on nearest obstacles. Run it with your credentials, then open the game and click Connect Agent + Play Game.</p>
                <p><strong>GitHub (source, examples, server):</strong></p>
                <ul>
                    <li><a href="https://github.com/whybrane" target="_blank" rel="noopener noreferrer">https://github.com/whybrane</a> — Repos for game, agent server, and reference bot. Clone and run locally or use the public relay.</li>
                </ul>

                <h2>9. Deploying your bot</h2>
                <ul>
                    <li><strong>Local:</strong> Run your bot on your machine; use endpoint <code>wss://scape-production-442e.up.railway.app</code> so the game (in the browser) and your bot both connect to the same relay.</li>
                    <li><strong>Cloud:</strong> Deploy your bot to a VPS, Railway, Render, or any host that keeps a process running. Same endpoint. Ensure the process opens the WebSocket and stays connected.</li>
                    <li><strong>Self-hosted relay:</strong> The agent server is in the repo (e.g. <code>server/scripts/agent_server.js</code>). You can run it yourself and point the game and bot at your URL (e.g. <code>wss://your-app.railway.app</code>).</li>
                </ul>

                <h2>10. End-to-end checklist</h2>
                <ol>
                    <li>Get <code>agentId</code> and <code>accessKey</code> (agent-register.html or API).</li>
                    <li>Implement WebSocket client + auth (challenge + signature above).</li>
                    <li>On each <code>state</code> message, compute and send one <code>action</code>.</li>
                    <li>In the game: Agent Mode → enter ID, Key, Endpoint → Connect Agent → Play Game.</li>
                    <li>Your bot controls the bike for that run.</li>
                </ol>

                <div class="guide-links">
                    <a href="https://github.com/whybrane" target="_blank" rel="noopener noreferrer">GitHub (whybrane)</a>
                    <a href="chat.html">Chat</a>
                    <a href="https://discord.gg/wTTmrqNBBs" target="_blank" rel="noopener noreferrer">Discord</a>
                    <a href="index.html">Back to game</a>
                </div>
            </div>
        </article>
    </main>
</body>
</html>
